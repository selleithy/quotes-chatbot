<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Uplift Chatbot</title>
    <style>
    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        color: #fff;
        display: flex;
        flex-direction: column;
        height: 100vh;
        transition: background 0.5s ease;
    }
    body.light-mode {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    .theme-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: #fff;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
    }
    .chat-container {
        flex: 1;
        max-width: 600px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        overflow-y: auto;
        margin-bottom: 20px;
        animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 10px;
        max-width: 80%;
        animation: messageSlide 0.3s ease;
    }
    @keyframes messageSlide {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }
    .user-message {
        background: rgba(255, 255, 255, 0.2);
        align-self: flex-end;
        margin-left: auto;
    }
    .bot-message {
        background: rgba(255, 255, 255, 0.3);
        align-self: flex-start;
    }
    .quote {
        font-style: italic;
        font-size: 16px;
        line-height: 1.4;
    }
    .author {
        font-size: 14px;
        opacity: 0.9;
        margin-top: 5px;
        text-align: right;
    }
    .feelings-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .feelings-buttons button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: #fff;
        padding: 10px 15px;
        border-radius: 20px;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
    }
    .feelings-buttons button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
    }
    .input-area {
        display: flex;
        max-width: 600px;
        margin: 0 auto;
        gap: 10px;
    }
    .input-area input {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
    }
    .input-area input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    .input-area button {
        background: #fff;
        color: #667eea;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s;
    }
    .input-area button:hover {
        transform: scale(1.05);
    }
    .add-form {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        max-width: 400px;
        margin: 20px auto;
    }
    .add-form input, .add-form textarea, .add-form select {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: none;
        border-radius: 5px;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
    }
    .add-form select option {
        background: #667eea;
        color: #fff;
    }
    .add-form textarea {
        height: 80px;
        resize: vertical;
    }
    .add-form button {
        background: #fff;
        color: #667eea;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        width: 100%;
        transition: background 0.3s;
    }
    .add-form button:hover {
        background: #f0f0f0;
    }
    /* Mobile responsive */
    @media (max-width: 600px) {
        body { padding: 10px; }
        .feelings-buttons { gap: 5px; }
        .feelings-buttons button { padding: 8px 12px; font-size: 14px; }
        .input-area { flex-direction: column; }
    }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 10px;">Mood Uplift Chatbot</h1>
    <p style="text-align: center; margin-bottom: 20px;">Select a feeling below, or type a message. I'll uplift you with a quote!</p>
    
    <div class="feelings-buttons">
     <button onclick="selectFeeling('sad')">üò¢ Sad</button>
    <button onclick="selectFeeling('anxious')">üò∞ Anxious</button>
    <button onclick="selectFeeling('angry')">üò† Angry</button>
    <button onclick="selectFeeling('frustrated')">üò§ Frustrated</button>
    <button onclick="selectFeeling('stressed')">üò© Stressed</button>
    <button onclick="selectFeeling('overwhelmed')">üòµ Overwhelmed</button>
    <button onclick="selectFeeling('exhausted')">üòì Exhausted</button>
    <button onclick="selectFeeling('unmotivated')">üò¥ Unmotivated</button>
    <button onclick="selectFeeling('lonely')">üòî Lonely</button>
    <button onclick="selectFeeling('detached')">üòê Detached</button>
    <button onclick="selectFeeling('fearful')">üò® Fearful</button>
    <button onclick="selectFeeling('heartbroken')">üíî Heartbroken</button>
    <button onclick="selectFeeling('despairing')">üòû Despairing</button>
    <button onclick="selectFeeling('grateful')">üòä Grateful</button>
    <button onclick="selectFeeling('longing')">üåü Longing</button>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
            <div>Hi! I'm here to uplift you with inspiring quotes. Pick a feeling or chat with me.</div>
        </div>
    </div>
    
    <div class="input-area">
        <input type="text" id="userInput" placeholder="Type a message... (e.g., I'm feeling down)" onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">Send</button>

<!-- adding a voice button -->
        <button id="micButton" style="background: rgba(255, 255, 255, 0.2); border: none; color: #fff; padding: 10px; border-radius: 20px; cursor: pointer; font-size: 18px; display: block;">üé§</button>
    </div>

    <form class="add-form" onsubmit="addQuote(event)">
        <select id="feelingInput" required>
        <option value="">Select Feeling</option>
        <option value="agitated">Agitated</option>
        <option value="ambivalent">Ambivalent</option>
        <option value="anxious">Anxious</option>
        <option value="angry">Angry</option>
        <option value="apathetic">Apathetic</option>
        <option value="ashamed">Ashamed</option>
        <option value="burnt out">Burnt Out</option>
        <option value="confused">Confused</option>
        <option value="despairing">Despairing</option>
        <option value="detached">Detached</option>
        <option value="disgusted">Disgusted</option>
        <option value="distressed">Distressed</option>
        <option value="embarrassed">Embarrassed</option>
        <option value="exhausted">Exhausted</option>
        <option value="fearful">Fearful</option>
        <option value="forlorn">Forlorn</option>
        <option value="frustrated">Frustrated</option>
        <option value="grateful">Grateful</option>
        <option value="heartbroken">Heartbroken</option>
        <option value="insecure">Insecure</option>
        <option value="jittery">Jittery</option>
        <option value="longing">Longing</option>
        <option value="lonely">Lonely</option>
        <option value="nostalgic">Nostalgic</option>
        <option value="overwhelmed">Overwhelmed</option>
        <option value="repulsed">Repulsed</option>
        <option value="resentful">Resentful</option>
        <option value="sad">Sad</option>
        <option value="stressed">Stressed</option>
        <option value="unmotivated">Unmotivated</option>
        <option value="uneasy">Uneasy</option>
        </select>
        <input type="text" id="authorInput" placeholder="Author (optional)">
        <textarea id="textInput" placeholder="Enter an inspiring quote" required></textarea>
        <button type="submit">Add Quote</button>
    </form>

    <script>
        const API_BASE = ''; // Empty for relative paths on live deploy

        function addMessage(text, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            const uniqueId = 'msg-' + Date.now(); // Unique ID for each message to avoid conflicts
            messageDiv.innerHTML = isUser ? `<div>${text}</div>` : `
                <div>${text}</div>
                <div class="quote" id="${uniqueId}-quote"></div>
                <div class="author" id="${uniqueId}-author"></div>
            `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return uniqueId; // Return for filling quote later
        }

        async function getUpliftingQuote(feeling) {
            try {
                const response = await fetch(`${API_BASE}/quotes/by-feeling?feeling=${feeling}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const quote = await response.json();
                return quote;
            } catch (error) {
                console.error('Error loading quote:', error);
                return { text: 'Hang in there! Sometimes the best quotes come from within.', author: 'You' };
            }
        }

        async function selectFeeling(feeling) {
            const userMessage = `I'm feeling ${feeling}.`;
            const botMessageId = addMessage(userMessage, true);
            const botResponseId = addMessage(`Here's something to uplift you for feeling ${feeling}:`, false);
            const quote = await getUpliftingQuote(feeling);
            const quoteEl = document.getElementById(`${botResponseId}-quote`);
            const authorEl = document.getElementById(`${botResponseId}-author`);
            if (quoteEl) quoteEl.textContent = quote.text;
            if (authorEl) authorEl.textContent = `- ${quote.author}`;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, true);
            input.value = '';

            // Simple keyword matching for feelings
            let feeling = 'general';
            const lowerMessage = message.toLowerCase();
            if (lowerMessage.includes('sad') || lowerMessage.includes('down')) feeling = 'sad';
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('worry')) feeling = 'anxious';
            else if (lowerMessage.includes('angry') || lowerMessage.includes('mad')) feeling = 'angry';
            else if (lowerMessage.includes('frustrated') || lowerMessage.includes('annoyed')) feeling = 'frustrated';
            else if (lowerMessage.includes('stress') || lowerMessage.includes('tense')) feeling = 'stressed';
            else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much')) feeling = 'overwhelmed';
            else if (lowerMessage.includes('exhausted') || lowerMessage.includes('tired')) feeling = 'exhausted';
            else if (lowerMessage.includes('unmotivated') || lowerMessage.includes('lazy')) feeling = 'unmotivated';
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('alone')) feeling = 'lonely';
            else if (lowerMessage.includes('detached') || lowerMessage.includes('numb')) feeling = 'detached';
            else if (lowerMessage.includes('fearful') || lowerMessage.includes('scared')) feeling = 'fearful';
            else if (lowerMessage.includes('heartbroken') || lowerMessage.includes('hurt')) feeling = 'heartbroken';
            else if (lowerMessage.includes('despairing') || lowerMessage.includes('hopeless')) feeling = 'despairing';
            else if (lowerMessage.includes('grateful') || lowerMessage.includes('thankful')) feeling = 'grateful';
            else if (lowerMessage.includes('longing') || lowerMessage.includes('miss')) feeling = 'longing';
            else if (lowerMessage.includes('confused') || lowerMessage.includes('lost')) feeling = 'confused';
            else if (lowerMessage.includes('disgusted') || lowerMessage.includes('gross')) feeling = 'disgusted';
            else if (lowerMessage.includes('agitated') || lowerMessage.includes('restless')) feeling = 'agitated';
            else if (lowerMessage.includes('ashamed') || lowerMessage.includes('guilty')) feeling = 'ashamed';
            else if (lowerMessage.includes('distressed') || lowerMessage.includes('upset')) feeling = 'distressed';

            const quote = await getUpliftingQuote(feeling);
            const botResponseId = addMessage(`I sense you're feeling ${feeling}. Here's an uplifting quote:`, false);
            const quoteEl = document.getElementById(`${botResponseId}-quote`);
            const authorEl = document.getElementById(`${botResponseId}-author`);
            if (quoteEl) quoteEl.textContent = quote.text;
            if (authorEl) authorEl.textContent = `- ${quote.author}`;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') sendMessage();
        }

        async function addQuote(event) {
            event.preventDefault();
            const text = document.getElementById('textInput').value;
            const author = document.getElementById('authorInput').value || 'Unknown';
            const feeling = document.getElementById('feelingInput').value;

            try {
                const response = await fetch(`${API_BASE}/quotes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, author, feeling })
                });
                if (response.ok) {
                    alert('Quote added successfully!');
                    document.getElementById('textInput').value = '';
                    document.getElementById('authorInput').value = '';
                    document.getElementById('feelingInput').value = '';
                } else {
                    alert('Error adding quote');
                }
            } catch (error) {
                console.error('Error adding quote:', error);
                alert('Error adding quote');
            }
        }
// Voice input setup
const micButton = document.getElementById('micButton');
if (micButton) {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        micButton.onclick = () => {
            recognition.start();
            micButton.textContent = 'üî¥';
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById('userInput').value = transcript;
            sendMessage();
            micButton.textContent = 'üé§';
        };

        recognition.onerror = () => {
            alert('Voice input failed‚Äîtry typing instead!');
            micButton.textContent = 'üé§';
        };
    } else {
        micButton.onclick = () => alert('Voice not supported in this browser‚Äîuse Chrome!');
        micButton.title = 'Voice not supported';
    }
}
    </script>
</body>
</html>
